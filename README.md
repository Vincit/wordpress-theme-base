# Vincit WordPress theme base
Bleeding edge starter theme.

## Features
- [x] Pagebuilder, powered by [ACF](https://www.advancedcustomfields.com/resources/flexible-content/)
- [x] Cleaner menus that are accessible
- [x] Saner the_content() to make certain layouts easier to build
- [x] Current environment is listed in window title
- [x] Accessible custom radiobuttons and checkboxes
- [x] Automatic editor stylesheet
- [x] (Multilingual) options page support
- [x] ~Ground-breaking but controversial cachebusting for assets~
- [x] Automatic asset manifest makes sure that users always get the latest files
- [x] Works with React (out-of-the-box, has demos)
- [x] Modern JavaScript support
  - [x] Built with Webpack 3
  - [x] **CSS Hot Module Replacement** (HMR)
  - [x] **JS Hot Module Replacement** (HMR)
  - [x] ES6+ (stage-2)
  - [x] ESLint
  - [x] Sourcemaps
  - [x] Nyancat progress bar
  - [x] Enforces case sensitive paths so build works on all platforms
- [x] CSS Preprocessor support
  - [×] Preconfigured with Stylus
- [x] PostCSS
  - [×] Autoprefixer
  - [x] Flexbug fixer
  - [] Any [PostCSS plugin](https://github.com/postcss/postcss#plugins) that you add (autogenerated RTL?)
- [x] Automatic image optimization using imagemin
- [x] PHPCS, based on PSR2.

## Screenshots
### Desktop
[Frontpage](https://i.imgur.com/ADIG8V7.jpg)
[Pagebuilder](https://i.imgur.com/JeRNEvk.jpg)
### Mobile
[Frontpage](https://i.imgur.com/8ONEags.jpg)
[Pagebuilder](https://i.imgur.com/0Xns0Db.png)

## Requirements / dependencies
- PHP 7
- Composer
- Node 6 (preferably latest)
- npm 5

Optional:
- [aucor/wp_query-route-to-rest-api](https://github.com/aucor/wp_query-route-to-rest-api) for sample widgets
- [ACF](https://advancedcustomfields.com) for options page support

The theme will fail with anything less than PHP 7, but making it PHP 5 compatible shouldn't be too hard, just fix the errors as they appear.

## Things to keep in mind
Webpack-dev-server will proxy your WordPress installation, and serve it through localhost:8080. WordPress doesn't know anything about this, and it will continue to output links with the original domain, so any forms or links do not work out of the box. The theme will enqueue a chunk of JS that will transform all links and forms that exist at DOMContentLoaded, so majority of links and forms will work. The adminbar is a prime example where links "do not work".

While the admin works (for the most part!) through wds, I wouldn't recommend using it. If you want to keep the admin bar visible while you develop the site, simply login twice. Once at https://wordpress.local/wp-admin, and once at https://localhost:8080/wp-admin.

**Why not?**

You *WILL* run into problems. Two examples from JavaScript console:
> Uncaught DOMException: Failed to execute 'replaceState' on 'History': A history state object with URL 'https://wordpress.local/wp-admin/post.php?post=439&action=edit' cannot be created in a document with origin 'https://localhost:8080' and URL 'https://localhost:8080/wp-admin/post.php?post=439&action=edit&message=6'.

> Access to Font at 'https://wordpress.local/wp-content/plugins/advanced-custom-fields-pro/assets/font/acf.woff?57601716' from origin 'https://localhost:8080' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'https://localhost:8080' is therefore not allowed access.

CORS isn't a problem normally, as we set `header("Access-Control-Allow-Origin: *");` to any request that's coming from wds,but the font in question isn't going through wds.

You're going to have a very bad time if you ignore this. If it's not a direct error, it's going to be a badly coded plugin that's going to cause it.

## Usage
Clone the theme or install it with the installer that ships with [Vincit/wordpress](https://github.com/Vincit/wordpress). Composer is also an option.
```sh
git clone git@github.com:Vincit/wordpress-theme-base.git themename

# OR (with first vagrant up if using Vincit/wordpress)
# Runs automatically. Answer yes to the question when prompted.

# OR (Vincit/wordpress installer)
./install # Follow the instructions

# OR (composer)
composer require vincit/wordpress-theme-base # append dev-master to get the latest version (potentially unstable)
```

Install dependencies:
```
npm install
```

### If you installed manually (and not with the installer)
Webpack requires some information from your setup. Mainly the URL of the site, and path to your theme. Open `package.json` and change `publicPath` and `proxyURL` to correct values.

Start watching for changes:
```
npm run watch # or npm run start, but webpack-dashboard is buggy at the moment
```

Find & replace at least these strings:
`wordpress-theme-base` => ???

`WordPress theme base` => ???

```
find . -not -path "./node_modules/*" -type f -name "*.*" -exec sed -i'' -e 's/wordpress-theme-base/your-desired-slug/g' {} +
find . -not -path "./node_modules/*" -type f -name "*.*" -exec sed -i'' -e 's/WordPress theme base/Your theme name/g' {} +
```

## FAQ
### What's with the folder structure?
- build/ contains build related things, such as Webpack config.
- dist/ contains the build itself. Never committed to version control.
- inc/ contains server side includes. Basically if you would put it in functions.php, put it here.
- src/ contains client side source files, including JavaScript, Stylus and images.
  - js/ contains JavaScript files.
  - styl/ contains Stylus files.
  - img/ contains images, including SVGs.
  - Files inside src/ directly will be used to build files: `client.styl` => `client.css` and so on.

### Why are the styles flashing when I'm first loading the page?
In development styles are included in JS, and take a bit of time to load. The flashing does not occur when using the production build.

### WTF, why are you importing a `.styl` file inside JavaScript?
Ask Webpack. Get over it. Basically Webpack doesn't know about them otherwise.

### I installed all the dependencies and ran npm run watch, but when I try to access http://localhost:8080 I get the following error: Error occured while trying to proxy to: localhost:8080/
You don't have WordPress installed at https://wordpress.local, which is the default address. Change the proxyURL value in package.json and try again.

### You promised us HMR, but it doesn't work?!!
See above. HMR requires publicPath value to work. This theme defaults to http://localhost:8080/wp-content/themes/wordpress-theme-base/dist/, if you installed the theme in a directory with another name you obviously need to change it.
Change the value in package.json.

### I did the above but HMR still doesn't work?
Git gud. HMR requires you to write your code accordingly, example:
- [Module](https://github.com/Vincit/wordpress-theme-base/blob/master/src/js/components/clock.js)
- [sample.js](https://github.com/Vincit/wordpress-theme-base/blob/master/src/sample.js)

If using React, you should be set.

Consult Webpack documentation if necessary.

### I get a white screen or Fatal error: Uncaught Exception: Enqueued file must be a css or js file
Build the theme after installing it. Run `npm install`.

### How to use webfonts?
Place the font files in src/fonts. The loaders working directory is src, even if you use @font-face in styl/typography.styl.

```css
@font-face {
  font-family: 'FontName'
  src: url('./fonts/Font.eot')
  src: local('.'), local('.'),
    url('./fonts/Font.eot?#iefix') format('embedded-opentype'),
    url('./fonts/Font.woff') format('woff'),
    url('./fonts/Font.ttf') format('truetype')
  font-weight: normal
  font-style: normal
}
```

### I tried to use an svg background image but it doesn't quite work
[svg-inline-loader](https://github.com/webpack-contrib/svg-inline-loader) purifies SVGs and inlines them, so `background: url('./img/svg/background.svg')` results in `background: url(<svg>..</svg>)`.

The solution is to put the SVG in src/img/no-inline/svg directory: `background: url('./img/no-inline/svg/close.svg')` => `background: url(data:image/svg+xml;base64...)`


## I got "TypeError: Cannot read property 'split' of null" when starting the watcher
Most likely the proxyURL in package.json is wrong. Make sure to include protocol: `https://wordpress.local`

## I've started the watcher, but I have no styles and JavaScript is broken? This started on it's own.
It's possible that your browser has stopped trusting the certificate (happens surprisingly often, at least on Chrome on Linux).

Scripts and styles are loaded from https://wordpress.local, even though the development server runs on https://localhost:8080. If your system doesn't trust self-signed certificates automatically, you might have to navigate to https://wordpress.local, and add an exception or confirm that you want to use the site, regardless of the "dangerous" cert.

